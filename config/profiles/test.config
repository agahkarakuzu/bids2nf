// Test profile configuration

params {
    bids_dir = "${projectDir}/../../tests/data/custom/ds-mtsat"
    bids2nf_config = "${projectDir}/../../bids2nf.yaml"
    libbids_sh = "${projectDir}/../../libBIDS.sh/libBIDS.sh"
    
    // Test resource limits
    max_memory = '2 GB'
    max_cpus = 2
    max_time = '30m'
    
    // Test settings
    debug_mode = false
    log_level = 'INFO'
    bids_validation = true
    
    // Test output
    output_dir = 'test/new_outputs'
    publish_dir_mode = 'copy'
}

// Enable Docker for container processes
docker {
    enabled = true
    runOptions = '--platform linux/amd64'
}

process {
    executor = 'local'
    
    // Test shell configuration - try different shells for compatibility
    shell = ['/bin/bash', '-ue']
    
    // Minimal resource allocation for tests
    memory = '512 MB'
    cpus = 1
    time = '15m'
    
    // Fail fast for tests
    errorStrategy = 'terminate'
    maxRetries = 0
    
    // Test-specific process overrides
    withName: 'LIBBIDS_SH_PARSE' {
        memory = '1 GB'
        time = '10m'
    }
    
    withName: 'ENTITY_BASED_GROUPING' {
        memory = '1 GB'
        time = '15m'
    }
    
    withName: 'INGEST_EBG_MTS_CHANNEL' {
        memory = '512 MB'
        time = '5m'
    }
}

// Minimal reporting for tests
timeline.enabled = false
report.enabled = false
trace.enabled = true
trace.overwrite = true
dag.enabled = false